%function Volume_vs_Time() for surface tension isotherms
%ensure you're in SDS folder before beginning
%con_id= user input to define what concentration of surfactant using

%entering inputs for droplets
surfactant= input('Please enter surfactant  ', 's');
base_path = 'C:\Research\Pendant Drop\PendantDropTensiometer-master\Soluble Surfactant Testing' ; 
mkdir('C:\Research\Pendant Drop\PendantDropTensiometer-master\Soluble Surfactant Testing\',char(surfactant));
current_folder= strcat('C:\Research\Pendant Drop\PendantDropTensiometer-master\Soluble Surfactant Testing\',char(surfactant));
cd (current_folder);

for decision_for_loop= input('Continue? Enter Y or N.  ' , 's');
    decision= decision_for_loop;
while decision== 'Y'
   con_id= input('Please enter number for surfactant concentration in mM. If finished with test, press ctrl+c.  ','s'); 
   drop_id= input('Please enter droplet number ','s');
   droplet_number = strcat('_D_',drop_id);
   %droplet_fname= strcat('H20_air_',surfactant,'_','C00',con_id,droplet_number);
   pause(1);
   
    clc;

    totalTime = 5*1.5; % Time in seconds
    period = 1.5 ; % NOTE: cannot go below 1.5s and value is approximate
    CameraNum = 1;

    % Parse imput parameters
    N = ceil(totalTime/period); 
    period = period - 1.5;
    % Initialize
    vid = Connect2Camera(CameraNum,'side');
    t=zeros(1,N); %initializing time vector

    %user input for naming folder    


    %user required to push enter to continue, getting reference image of
    %capillary
    fprintf('Please put capillary tip in focus and press "Enter" to take first image.')
    preview(vid)
    pause


    start(vid)
    %take image
    img = getdata(vid);
    stop(vid);
    conversion_step= num2str(i);
    capillary_name= strcat('CapillaryImage','_',conversion_step,'.png');
    imwrite(img,capillary_name);

    %user required to push enter to continue
    fprintf('Please create droplet and immediately press "Enter" to start time delay and time lapse.')
    pause
    closepreview
    pause(1)

    tic
    for j = 1:N
        start(vid)
        %take image
        img = getdata(vid);
        t(j)=toc;
        stop(vid);
        
        index_conversion= num2str(j);
        droplet_file_name = strcat('H20_air_',surfactant,'_','C00',con_id,droplet_number,'_I_',index_conversion,'_.png');
        currentFile = sprintf(droplet_file_name,j);
        imwrite(img,currentFile)
        pause(period)
    end
    
    naming_time_vector= strcat('timeVector','_',conversion_step,'.csv');
    csvwrite(naming_time_vector,t(1:N-1))

    % Close camera
    clear vid
end 
end 
